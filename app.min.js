var ipsbEl=document.getElementById("ipsb"),ipsbGeoEl=document.getElementById("ipsb-geo"),ippconlineEl=document.getElementById("ipcn"),ippconlineGeoEl=document.getElementById("ipcn-geo"),ldnsEl=document.getElementById("ldns"),ldnsGeoEl=document.getElementById("ldns-geo"),ldns2El=document.getElementById("ldns2"),ldns2GeoEl=document.getElementById("ldns2-geo"),osEl=document.getElementById("os"),browserEl=document.getElementById("browser"),uaEl=document.getElementById("useragent"),flashEl=document.getElementById("flash"),cookieEl=document.getElementById("cookie"),lsEl=document.getElementById("ls"),get=function(e,n){var t=new XMLHttpRequest;t.onreadystatechange=function(e){4===this.readyState&&e(this.responseText)}.bind(t,n),t.onerror=function(){alert("出错啦，请刷新重试")},t.open("GET",e),t.send()};function getipsb(e){ipsbEl.innerHTML=e.ip,get("api/parseip/"+e.ip,function(e){e=JSON.parse(e),ipsbGeoEl.innerHTML=[e.country,e.region,e.city,e.organization].join(" ")})}function getipPconline(){ippconlineEl.innerHTML=returnCitySN.cip,get("api/parseip/"+returnCitySN.cip,function(e){e=JSON.parse(e),ippconlineGeoEl.innerHTML=[e.country,e.region,e.city,e.organization].join(" ")})}getipPconline();var getLocalDNS=function(){var e=(new Date).getTime()+Math.random()+".sngdia.imtmp.net",n="http://"+e+"/s",t=new Image;t.onload=function(){get("api/ldns?d="+e,function(e){if(!e)return ldnsEl.textContent="获取失败，请刷新重试";ldnsEl.textContent=e,get("api/parseip/"+e,function(e){e=JSON.parse(e),ldnsGeoEl.innerHTML=[e.country,e.region,e.city,e.organization].join(" ")})})},t.src=n},getAnotherLocalDNS=function(){var e=(new Date).getTime()+Math.random()+".sngdia.imtmp.net",n="http://"+e+"/s",t=new Image;t.onload=function(){get("api/ldns?d="+e,function(e){if(!e)return ldnsEl.textContent="获取失败，请刷新重试";ldns2El.textContent=e,get("api/parseip/"+e,function(e){e=JSON.parse(e),ldns2GeoEl.innerHTML=[e.country,e.region,e.city,e.organization].join(" ")})})},t.src=n};getLocalDNS(),getAnotherLocalDNS();var getOsInfo=function(){var e=navigator.userAgent,n="Win32"===navigator.platform||"Windows"===navigator.platform,t="Mac68K"===navigator.platform||"MacPPC"===navigator.platform||"Macintosh"===navigator.platform||"MacIntel"===navigator.platform,i=e.match("iPad"),o=e.match("iPhone"),r="X11"===navigator.platform&&!n&&!t,a=-1<String(navigator.platform).indexOf("Linux"),c=e.match("Android"),l=e.match("Windows CE")||e.match("WinCE")||e.match("WindowsCE"),d=e.match("Windows Mobile"),s=e.match("Windows Phone OS");if(i||o)return"iOS";if(t)return"mac";if(r)return"Unix";if(a)return c?"Android":"Linux";if(l)return"Windows CE";if(d)return"Windows Mobile";if(s)return"Windows Phone";if(e.match("BlackBerry"))return"BlackBerry OS";if(e.match("RIM Tablet OS"))return"BlackBerry Tablet OS";if(e.match("(?:web|hpw)OS"))return"webOS";if(e.match("SymbianOS/9.1")||e.match("Series[ ]?60")||e.match("S60"))return"Series60";if(n){if(-1<e.indexOf("Windows NT 5.0")||-1<e.indexOf("Windows 2000"))return"Windows 2000";if(-1<e.indexOf("Windows NT 5.1")||-1<e.indexOf("Windows XP"))return"Windows XP";if(-1<e.indexOf("Windows NT 5.2")||-1<e.indexOf("Windows 2003"))return"Windows 2003";if(-1<e.indexOf("Windows NT 6.0")||-1<e.indexOf("Windows Vista"))return"Windows Vista";if(-1<e.indexOf("Windows NT 6.1")||-1<e.indexOf("Windows 7"))return"Windows 7";if(-1<e.indexOf("Windows NT 6.2")||-1<e.indexOf("Windows 8"))return"Windows 8"}return"其它（未检出）"},getBrowser=function(){var e,n=navigator.userAgent,t=n.match(/(opera|chrome|safari|firefox|msie|trident(?=\/))\/?\s*(\d+)/i)||[];return n.match("MicroMessenger")?"Weixin":/trident/i.test(t[1])?"IE "+((e=/\brv[ :]+(\d+)/g.exec(n)||[])[1]||""):"Chrome"===t[1]&&null!=(e=n.match(/\b(OPR|Edge)\/(\d+)/))?e.slice(1).join(" ").replace("OPR","Opera"):(t=t[2]?[t[1],t[2]]:[navigator.appName,navigator.appVersion,"-?"],null!=(e=n.match(/version\/(\d+)/i))&&t.splice(1,1,e[1]),t.join(":"))},getFlash=function(){var e,n=NaN;navigator.userAgent;if(window.ActiveXObject)(e=new ActiveXObject("ShockwaveFlash.ShockwaveFlash"))&&(n=Number(e.GetVariable("$version").split(" ")[1].replace(/,/g,".").replace(/^(d+.d+).*$/,"$1")));else if(navigator.plugins&&0<navigator.plugins.length&&(e=navigator.plugins["Shockwave Flash"]))for(var t=e.description.split(" "),i=0,o=t.length;i<o;i++){var r=Number(t[i]);if(!isNaN(r)){n=t[i];break}}return isNaN(n)?"未安装":n},getCookieInfo=function(){var e=new Date;e.setTime(e.getTime()+1e4),document.cookie="cookie_test="+escape("1")+";expires="+e.toGMTString();var n=document.cookie.match(new RegExp("(^| )cookie_test=([^;]*)(;|$)"));return null!==n&&"1"===unescape(n[2])?"开启":"关闭"},getLocalStorageInfo=function(){var e="pingtest";try{return localStorage.setItem(e,e),localStorage.removeItem(e),"开启"}catch(e){return"关闭"}};osEl.textContent=getOsInfo(),browserEl.textContent=getBrowser(),flashEl.textContent=getFlash(),uaEl.textContent=navigator.userAgent,cookieEl.textContent=getCookieInfo(),lsEl.textContent=getLocalStorageInfo();for(var connectData=[],domainEl=document.getElementsByClassName("domain-list"),i=0;i<domainEl.length;i+=1)connectData.push(domainEl[i].getAttribute("id")),domainEl[i].querySelector(".domain").innerHTML=domainEl[i].getAttribute("id");for(var timeout=6e3,checkLoadTime=function(e,n){var t=document.createElement("img"),i=n+"://"+e+"/favicon.icon";t.protocol=n,t.onload=setDeferTime,t.onerror=setDeferTime,t.domain=e,t.src=i+"?"+String(Math.random()),t.dt=new Date,document.getElementById("imgload").appendChild(t),setTimeout(function(){t.loaded||(document.getElementById(t.domain).querySelector("."+t.protocol).innerHTML=t.protocol.toUpperCase()+": &nbsp;&gt;"+timeout)},timeout)},setDeferTime=function(){this.loaded=!0;var e=parseInt(new Date-this.dt);document.getElementById(this.domain).querySelector("."+this.protocol).innerHTML=e},len=(i=0,connectData.length);i<len;i++)checkLoadTime(connectData[i],"http"),checkLoadTime(connectData[i],"https");