var ipsbEl=document.getElementById("ipsb"),ipsbGeoEl=document.getElementById("ipsb-geo"),ippconlineEl=document.getElementById("ipcn"),ippconlineGeoEl=document.getElementById("ipcn-geo"),ldnsEl=document.getElementById("ldns"),ldnsGeoEl=document.getElementById("ldns-geo"),ldns2El=document.getElementById("ldns2"),ldns2GeoEl=document.getElementById("ldns2-geo"),osEl=document.getElementById("os"),browserEl=document.getElementById("browser"),uaEl=document.getElementById("useragent"),flashEl=document.getElementById("flash"),cookieEl=document.getElementById("cookie"),lsEl=document.getElementById("ls"),get=function(e,t){var n=new XMLHttpRequest;n.onreadystatechange=function(e){4===this.readyState&&e(this.responseText)}.bind(n,t),n.onerror=function(){alert("出错啦，请刷新重试")},n.open("GET",e),n.send()};function getipsb(e){ipsbEl.innerHTML=e.ip,get("https://api.skk.moe/network/parseIp/ipip/"+e.ip,function(e){e=JSON.parse(e);var t="";for(var n in e)t+=""!==e[n]?e[n]+" ":"";ipsbGeoEl.innerHTML=t})}function getipPconline(){ippconlineEl.innerHTML=returnCitySN.cip,get("https://api.skk.moe/network/parseIp/ipip/"+returnCitySN.cip,function(e){e=JSON.parse(e),ippconlineGeoEl.innerHTML=[e.country,e.region,e.city,e.organization].join(" ")})}getipPconline();var getLocalDNS=function(){get("https://cdn.dns-detect.alicdn.com/api/cdnDetectHttps?method=createDetectHttps",function(e){if(!e)return ldnsEl.textContent="获取失败，请刷新重试";get(e.content,function(e){console.log(e)})});var e=(new Date).getTime()+Math.random()+".sngdia.imtmp.net",t="http://"+e+"/s",n=new Image;n.onload=function(){get("api/ldns?d="+e,function(e){if(!e)return ldnsEl.textContent="获取失败，请刷新重试";ldnsEl.textContent=e,get("https://api.skk.moe/network/parseIp/ipip/"+e,function(e){e=JSON.parse(e),ldnsGeoEl.innerHTML=[e.country,e.region,e.city,e.organization].join(" ")})})},n.src=t},getAnotherLocalDNS=function(){var e=(new Date).getTime()+Math.random()+".sngdia.imtmp.net",t="http://"+e+"/s",n=new Image;n.onload=function(){get("api/ldns?d="+e,function(e){if(!e)return ldnsEl.textContent="获取失败，请刷新重试";ldns2El.textContent=e,get("https://api.skk.moe/network/parseIp/ipip/"+e,function(e){e=JSON.parse(e),ldns2GeoEl.innerHTML=[e.country,e.region,e.city,e.organization].join(" ")})})},n.src=t};getLocalDNS(),getAnotherLocalDNS();var getOsInfo=function(){var e=navigator.userAgent,t="Win32"===navigator.platform||"Windows"===navigator.platform,n="Mac68K"===navigator.platform||"MacPPC"===navigator.platform||"Macintosh"===navigator.platform||"MacIntel"===navigator.platform,i=e.match("iPad"),o=e.match("iPhone"),r="X11"===navigator.platform&&!t&&!n,a=-1<String(navigator.platform).indexOf("Linux"),c=e.match("Android"),s=e.match("Windows CE")||e.match("WinCE")||e.match("WindowsCE"),l=e.match("Windows Mobile"),d=e.match("Windows Phone OS");if(i||o)return"iOS";if(n)return"mac";if(r)return"Unix";if(a)return c?"Android":"Linux";if(s)return"Windows CE";if(l)return"Windows Mobile";if(d)return"Windows Phone";if(e.match("BlackBerry"))return"BlackBerry OS";if(e.match("RIM Tablet OS"))return"BlackBerry Tablet OS";if(e.match("(?:web|hpw)OS"))return"webOS";if(e.match("SymbianOS/9.1")||e.match("Series[ ]?60")||e.match("S60"))return"Series60";if(t){if(-1<e.indexOf("Windows NT 5.0")||-1<e.indexOf("Windows 2000"))return"Windows 2000";if(-1<e.indexOf("Windows NT 5.1")||-1<e.indexOf("Windows XP"))return"Windows XP";if(-1<e.indexOf("Windows NT 5.2")||-1<e.indexOf("Windows 2003"))return"Windows 2003";if(-1<e.indexOf("Windows NT 6.0")||-1<e.indexOf("Windows Vista"))return"Windows Vista";if(-1<e.indexOf("Windows NT 6.1")||-1<e.indexOf("Windows 7"))return"Windows 7";if(-1<e.indexOf("Windows NT 6.2")||-1<e.indexOf("Windows 8"))return"Windows 8"}return"其它（未检出）"},getBrowser=function(){var e,t=navigator.userAgent,n=t.match(/(opera|chrome|safari|firefox|msie|trident(?=\/))\/?\s*(\d+)/i)||[];return t.match("MicroMessenger")?"Weixin":/trident/i.test(n[1])?"IE "+((e=/\brv[ :]+(\d+)/g.exec(t)||[])[1]||""):"Chrome"===n[1]&&null!=(e=t.match(/\b(OPR|Edge)\/(\d+)/))?e.slice(1).join(" ").replace("OPR","Opera"):(n=n[2]?[n[1],n[2]]:[navigator.appName,navigator.appVersion,"-?"],null!=(e=t.match(/version\/(\d+)/i))&&n.splice(1,1,e[1]),n.join(":"))},getFlash=function(){var e,t=NaN;navigator.userAgent;if(window.ActiveXObject)(e=new ActiveXObject("ShockwaveFlash.ShockwaveFlash"))&&(t=Number(e.GetVariable("$version").split(" ")[1].replace(/,/g,".").replace(/^(d+.d+).*$/,"$1")));else if(navigator.plugins&&0<navigator.plugins.length&&(e=navigator.plugins["Shockwave Flash"]))for(var n=e.description.split(" "),i=0,o=n.length;i<o;i++){var r=Number(n[i]);if(!isNaN(r)){t=n[i];break}}return isNaN(t)?"未安装":t},getCookieInfo=function(){var e=new Date;e.setTime(e.getTime()+1e4),document.cookie="cookie_test="+escape("1")+";expires="+e.toGMTString();var t=document.cookie.match(new RegExp("(^| )cookie_test=([^;]*)(;|$)"));return null!==t&&"1"===unescape(t[2])?"开启":"关闭"},getLocalStorageInfo=function(){var e="pingtest";try{return localStorage.setItem(e,e),localStorage.removeItem(e),"开启"}catch(e){return"关闭"}};osEl.textContent=getOsInfo(),browserEl.textContent=getBrowser(),flashEl.textContent=getFlash(),uaEl.textContent=navigator.userAgent,cookieEl.textContent=getCookieInfo(),lsEl.textContent=getLocalStorageInfo();for(var connectData=[],domainEl=document.getElementsByClassName("domain-list"),i=0;i<domainEl.length;i+=1)connectData.push(domainEl[i].getAttribute("id")),domainEl[i].querySelector(".domain").innerHTML=domainEl[i].getAttribute("id");for(var timeout=6e3,checkLoadTime=function(e,t){var n=document.createElement("img"),i=t+"://"+e+"/favicon.icon";n.protocol=t,n.onload=setDeferTime,n.onerror=setDeferTime,n.domain=e,n.src=i+"?"+String(Math.random()),n.dt=new Date,document.getElementById("imgload").appendChild(n),setTimeout(function(){n.loaded||(document.getElementById(n.domain).querySelector("."+n.protocol).innerHTML=n.protocol.toUpperCase()+": &nbsp;&gt;"+timeout)},timeout)},setDeferTime=function(){this.loaded=!0;var e=parseInt(new Date-this.dt);document.getElementById(this.domain).querySelector("."+this.protocol).innerHTML=e},len=(i=0,connectData.length);i<len;i++)checkLoadTime(connectData[i],"http"),checkLoadTime(connectData[i],"https");